<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hardware AR - Ultimate Edition</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@300;400;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #00ff88;
            --accent: #00ccff;
            --glass: rgba(10, 15, 20, 0.6);
            --glass-border: rgba(0, 255, 136, 0.2);
            --text: #ffffff;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: #050505;
            font-family: 'Inter', sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- UI TECH (Centralizada & Moderna) --- */

        #header-container {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 90%;
            max-width: 600px;
            pointer-events: none;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        h1 {
            margin: 0;
            color: white;
            font-family: 'Rajdhani', sans-serif;
            font-size: 32px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
            background: linear-gradient(to right, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 400;
            letter-spacing: 1px;
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px);
        }

        /* Doca Tech */
        #selection-dock {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
            padding: 16px 24px;
            background: var(--glass);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.1);
            z-index: 20;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .model-btn {
            width: 64px;
            height: 64px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .model-btn:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .model-btn.active {
            border-color: var(--primary);
            color: white;
            transform: translateY(-6px);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3), inset 0 0 10px rgba(0, 255, 136, 0.1);
            background: rgba(0, 255, 136, 0.05);
        }

        .btn-icon {
            font-size: 24px;
            margin-bottom: 4px;
            filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.8));
        }

        .btn-label {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1px;
            font-family: 'Rajdhani';
        }

        /* Bot√£o AR Centralizado */
        button#ARButton {
            position: absolute !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            bottom: 40px !important;
            background: var(--primary) !important;
            color: black !important;
            border-radius: 8px !important;
            width: 200px !important;
            height: 48px !important;
            font-family: 'Rajdhani' !important;
            font-weight: 700 !important;
            font-size: 16px !important;
            text-transform: uppercase !important;
            letter-spacing: 2px !important;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4) !important;
            border: none !important;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }

        #ar-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 16px 32px;
            border-radius: 4px;
            font-size: 16px;
            font-family: 'Rajdhani';
            font-weight: 700;
            display: none;
            pointer-events: none;
            letter-spacing: 2px;
            text-transform: uppercase;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.2);
        }

        #loader {
            position: absolute;
            inset: 0;
            background: #050505;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(0, 255, 136, 0.1);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 0.8s infinite linear;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div id="header-container">
        <h1>Hardware AR</h1>
        <div id="subtitle">Selecione um componente para visualizar em 3D</div>
    </div>

    <div id="selection-dock">
        <div class="model-btn active" onclick="window.selectModel('mobo')">
            <div class="btn-icon">üéõÔ∏è</div>
            <div class="btn-label">MOBO</div>
        </div>
        <div class="model-btn" onclick="window.selectModel('cpu')">
            <div class="btn-icon">‚ùÑÔ∏è</div>
            <div class="btn-label">COOLER</div>
        </div>
        <div class="model-btn" onclick="window.selectModel('gpu')">
            <div class="btn-icon">üìº</div>
            <div class="btn-label">GPU</div>
        </div>
        <div class="model-btn" onclick="window.selectModel('ram')">
            <div class="btn-icon">üíæ</div>
            <div class="btn-label">RAM</div>
        </div>
    </div>

    <div id="ar-guide">Mova o celular...</div>

    <div id="loader">
        <div class="spinner"></div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { ARButton } from 'three/addons/webxr/ARButton.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

        let camera, scene, renderer;
        let contentGroup, reticle;
        let hitTestSource = null, hitTestSourceRequested = false;
        let objectPlaced = false;

        let fans = [];
        let floatParts = [];
        let rgbTextureH, rgbTextureV;
        const mats = {};

        try { init(); animate(); } catch (e) { console.error(e); }

        function init() {
            const container = document.createElement('div');
            document.body.appendChild(container);

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.0;
            container.appendChild(renderer.domElement);

            const pmremGenerator = new THREE.PMREMGenerator(renderer);
            scene.environment = pmremGenerator.fromScene(new RoomEnvironment(), 0.04).texture;

            // Luzes
            const dir = new THREE.DirectionalLight(0xffffff, 2.5);
            dir.position.set(2, 5, 2); dir.castShadow = true; scene.add(dir);
            const spot = new THREE.SpotLight(0x00ff88, 8.0);
            spot.position.set(-2, 3, -1); spot.angle = 0.6; scene.add(spot);

            document.body.appendChild(ARButton.createButton(renderer, {
                requiredFeatures: ['hit-test', 'dom-overlay'],
                domOverlay: { root: document.body }
            }));

            createMaterials();

            contentGroup = new THREE.Group();
            scene.add(contentGroup);

            loadObject('mobo');

            reticle = new THREE.Mesh(
                new THREE.RingGeometry(0.1, 0.11, 32).rotateX(-Math.PI / 2),
                new THREE.MeshBasicMaterial({ color: 0x00ff88 })
            );
            reticle.matrixAutoUpdate = false; reticle.visible = false; scene.add(reticle);

            const controller = renderer.xr.getController(0);
            controller.addEventListener('select', onSelect);
            scene.add(controller);

            const controls = new OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 0.05, 0); controls.enableDamping = true;

            renderer.xr.addEventListener('sessionstart', () => {
                document.getElementById('ar-guide').style.display = 'block';
                document.getElementById('header-container').style.opacity = '0';
                document.getElementById('selection-dock').style.display = 'none';
                contentGroup.visible = false;
            });
            renderer.xr.addEventListener('sessionend', () => {
                document.getElementById('ar-guide').style.display = 'none';
                document.getElementById('header-container').style.opacity = '1';
                document.getElementById('selection-dock').style.display = 'flex';
                contentGroup.visible = true;
                contentGroup.position.set(0, 0, 0);
                camera.position.set(0, 0.3, 0.3); camera.lookAt(0, 0, 0);
            });

            window.addEventListener('resize', onWindowResize);
            document.getElementById('loader').style.display = 'none';
        }

        function createMaterials() {
            // Texturas
            const cvs = document.createElement('canvas'); cvs.width = 512; cvs.height = 512;
            const ctx = cvs.getContext('2d');
            ctx.fillStyle = '#111'; ctx.fillRect(0, 0, 512, 512);
            ctx.strokeStyle = '#222'; ctx.lineWidth = 2;
            for (let i = 0; i < 80; i++) { ctx.beginPath(); ctx.moveTo(Math.random() * 512, Math.random() * 512); ctx.lineTo(Math.random() * 512, Math.random() * 512); ctx.stroke(); }
            const pcbTex = new THREE.CanvasTexture(cvs);

            // RGB Rainbow
            const cvsH = document.createElement('canvas'); cvsH.width = 512; cvsH.height = 1;
            const ctxH = cvsH.getContext('2d');
            const grdH = ctxH.createLinearGradient(0, 0, 512, 0);
            grdH.addColorStop(0, '#ff0000'); grdH.addColorStop(0.2, '#ffff00'); grdH.addColorStop(0.4, '#00ff00');
            grdH.addColorStop(0.6, '#00ffff'); grdH.addColorStop(0.8, '#0000ff'); grdH.addColorStop(1, '#ff00ff');
            ctxH.fillStyle = grdH; ctxH.fillRect(0, 0, 512, 1);
            rgbTextureH = new THREE.CanvasTexture(cvsH);
            rgbTextureH.wrapS = THREE.RepeatWrapping;

            mats.pcb = new THREE.MeshStandardMaterial({ map: pcbTex, color: 0x222222, roughness: 0.4, metalness: 0.3 });
            mats.metal = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.2, metalness: 1.0 });
            mats.blackMetal = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.3, metalness: 0.9 });
            mats.whitePlastic = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.3, metalness: 0.1 });
            mats.alum = new THREE.MeshStandardMaterial({ color: 0xdddddd, roughness: 0.3, metalness: 0.8 });
            mats.copper = new THREE.MeshStandardMaterial({ color: 0xffaa77, roughness: 0.25, metalness: 1.0 });
            mats.blackPlastic = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.6, metalness: 0.1 });
            mats.rgbH = new THREE.MeshStandardMaterial({ map: rgbTextureH, emissive: 0xffffff, emissiveMap: rgbTextureH, emissiveIntensity: 2.5, roughness: 0.2, metalness: 0.0 });
        }

        window.selectModel = function (type) {
            document.querySelectorAll('.model-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');

            const titles = {
                'mobo': 'ASUS ROG MAXIMUS',
                'cpu': 'BLACK TOWER COOLER',
                'gpu': 'ROG STRIX WHITE',
                'ram': 'TRIDENT Z5 RGB'
            };
            document.querySelector('#header-container h1').innerText = titles[type];
            loadObject(type);
        }

        function loadObject(type) {
            contentGroup.clear();
            fans = []; floatParts = [];
            if (type === 'mobo') buildMobo();
            if (type === 'cpu') buildCPU_Cooler();
            if (type === 'gpu') buildGPU();
            if (type === 'ram') buildRAM();
        }

        // --- MODELOS ---

        function buildMobo() {
            const g = new THREE.Group();
            const pcb = new THREE.Mesh(new RoundedBoxGeometry(0.24, 0.004, 0.30, 4, 0.005), mats.pcb);
            pcb.receiveShadow = true; g.add(pcb);

            // Heatsinks
            const vrm1 = new THREE.Mesh(new RoundedBoxGeometry(0.04, 0.03, 0.14, 2, 0.002), mats.blackMetal);
            vrm1.position.set(-0.08, 0.015, -0.05); g.add(vrm1);
            const vrmStrip = new THREE.Mesh(new THREE.BoxGeometry(0.041, 0.004, 0.12), mats.rgbH);
            vrmStrip.position.set(-0.08, 0.031, -0.05); g.add(vrmStrip);

            const vrm2 = new THREE.Mesh(new RoundedBoxGeometry(0.14, 0.03, 0.04, 2, 0.002), mats.blackMetal);
            vrm2.position.set(0, 0.015, -0.10); g.add(vrm2);

            // Chipset
            const chipset = new THREE.Mesh(new RoundedBoxGeometry(0.08, 0.01, 0.08, 4, 0.005), mats.blackMetal);
            chipset.position.set(0.05, 0.01, 0.08); g.add(chipset);
            const eye = new THREE.Mesh(new THREE.PlaneGeometry(0.05, 0.05), mats.rgbH);
            eye.rotation.x = -Math.PI / 2; eye.position.set(0.05, 0.016, 0.08); g.add(eye);

            // Slots
            for (let i = 0; i < 3; i++) {
                const s = new THREE.Mesh(new THREE.BoxGeometry(0.16, 0.008, 0.012), mats.metal);
                s.position.set(0.01, 0.006, 0.04 + (i * 0.06)); g.add(s);
            }
            contentGroup.add(g);
        }

        function buildCPU_Cooler() {
            // BLACK TOWER DESIGN
            const g = new THREE.Group();

            // CPU Base
            const cpu = new THREE.Mesh(new THREE.BoxGeometry(0.04, 0.002, 0.04), mats.pcb);
            g.add(cpu);

            // Heatpipes Base
            const base = new THREE.Mesh(new RoundedBoxGeometry(0.05, 0.01, 0.05, 2, 0.002), mats.metal);
            base.position.y = 0.006; g.add(base);

            // Heatpipes (Copper)
            for (let i = 0; i < 4; i++) {
                const pipe = new THREE.Mesh(new THREE.CylinderGeometry(0.003, 0.003, 0.14, 16), mats.copper);
                pipe.position.set(-0.015 + (i * 0.01), 0.07, 0);
                g.add(pipe);
            }

            // Tower Heatsink (Black)
            const tower = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.12, 0.06), mats.blackMetal);
            tower.position.set(0, 0.08, 0);
            // Texture for fins
            g.add(tower);

            // Top Plate (Black with Logo)
            const top = new THREE.Mesh(new RoundedBoxGeometry(0.122, 0.005, 0.062, 2, 0.001), mats.blackPlastic);
            top.position.set(0, 0.142, 0); g.add(top);
            const logo = new THREE.Mesh(new THREE.PlaneGeometry(0.04, 0.02), mats.rgbH);
            logo.rotation.x = -Math.PI / 2; logo.position.set(0, 0.145, 0); g.add(logo);

            // Fan (Front)
            const fanGroup = new THREE.Group();
            fanGroup.position.set(0, 0.08, 0.035);

            // Fan Frame
            const frame = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.12, 0.025), mats.blackPlastic);
            fanGroup.add(frame);

            // RGB Ring (Thin ring on frame)
            const ring = new THREE.Mesh(new THREE.TorusGeometry(0.05, 0.002, 32, 64), mats.rgbH);
            ring.position.z = 0.013; fanGroup.add(ring);

            // Blades (Translucent Black)
            const bladeGroup = new THREE.Group();
            for (let k = 0; k < 9; k++) {
                const b = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.012, 0.002), mats.blackPlastic);
                b.position.x = 0.028; b.rotation.x = 0.4;
                const p = new THREE.Group();
                p.rotation.z = (k / 9) * Math.PI * 2;
                p.add(b);
                bladeGroup.add(p);
            }
            bladeGroup.position.z = 0.005;
            fanGroup.add(bladeGroup);
            fans.push(bladeGroup);

            g.add(fanGroup);
            contentGroup.add(g);
        }

        function buildGPU() {
            // WHITE ROG STRIX STYLE
            const g = new THREE.Group();

            // Main Body (White)
            const body = new THREE.Mesh(new RoundedBoxGeometry(0.32, 0.06, 0.13, 4, 0.01), mats.whitePlastic);
            body.position.y = 0.03; body.castShadow = true; g.add(body);

            // Backplate (White Metal)
            const backplate = new THREE.Mesh(new RoundedBoxGeometry(0.32, 0.004, 0.13, 4, 0.005), mats.alum);
            backplate.position.y = 0.062; g.add(backplate);

            // Side RGB Bar (Full length)
            const strip = new THREE.Mesh(new THREE.BoxGeometry(0.30, 0.01, 0.002), mats.rgbH);
            strip.position.set(0, 0.03, 0.066); g.add(strip);

            // 3 Fans
            for (let i = -1; i <= 1; i++) {
                const xPos = i * 0.095;

                // Chrome Ring around fan
                const ring = new THREE.Mesh(new THREE.TorusGeometry(0.048, 0.002, 32, 64), mats.metal);
                ring.rotation.x = -Math.PI / 2; ring.position.set(xPos, 0.061, 0); g.add(ring);

                // Blades (White)
                const fGroup = new THREE.Group();
                for (let k = 0; k < 11; k++) {
                    const b = new THREE.Mesh(new THREE.BoxGeometry(0.042, 0.008, 0.001), mats.whitePlastic);
                    b.position.x = 0.024; b.rotation.x = 0.4;
                    const p = new THREE.Group();
                    p.rotation.z = (k / 11) * Math.PI * 2;
                    p.add(b);
                    fGroup.add(p);
                }
                // RGB Center Hub
                const hub = new THREE.Mesh(new THREE.CylinderGeometry(0.012, 0.012, 0.005, 32), mats.rgbH);
                hub.rotation.x = Math.PI / 2; fGroup.add(hub);

                fGroup.rotation.x = -Math.PI / 2; fGroup.position.set(xPos, 0.058, 0);
                g.add(fGroup);
                fans.push(fGroup);
            }
            g.rotation.x = -Math.PI / 2; g.position.y = 0.05;
            contentGroup.add(g);
        }

        function buildRAM() {
            const g = new THREE.Group();
            for (let i = -1; i <= 1; i += 2) {
                const stick = new THREE.Group();
                stick.add(new THREE.Mesh(new THREE.BoxGeometry(0.133, 0.035, 0.002), mats.pcb));
                const heat = new THREE.Mesh(new RoundedBoxGeometry(0.135, 0.032, 0.006, 2, 0.001), mats.blackMetal);
                heat.position.y = 0.002; stick.add(heat);
                const rgb = new THREE.Mesh(new RoundedBoxGeometry(0.135, 0.01, 0.006, 2, 0.002), mats.rgbH);
                rgb.position.y = 0.022; stick.add(rgb);
                stick.position.z = i * 0.01; g.add(stick);
            }
            g.position.y = 0.05; contentGroup.add(g);
        }

        function onSelect() {
            if (reticle.visible) {
                const p = new THREE.Vector3(); camera.getWorldPosition(p);
                contentGroup.position.setFromMatrixPosition(reticle.matrix);
                if (Math.abs(p.x - contentGroup.position.x) > 0.01) contentGroup.lookAt(p.x, contentGroup.position.y, p.z);
                contentGroup.visible = true; objectPlaced = true;
                document.getElementById('ar-guide').innerText = "OBJETO FIXADO";
                setTimeout(() => document.getElementById('ar-guide').style.display = 'none', 2000);
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            renderer.setAnimationLoop(render);
        }

        function render(timestamp, frame) {
            const t = timestamp / 1000;
            if (frame) {
                const session = renderer.xr.getSession();
                if (!hitTestSourceRequested) {
                    session.requestReferenceSpace('viewer').then(ref =>
                        session.requestHitTestSource({ space: ref }).then(source => hitTestSource = source));
                    hitTestSourceRequested = true;
                }
                if (hitTestSource) {
                    const hits = frame.getHitTestResults(hitTestSource);
                    if (hits.length > 0) {
                        reticle.visible = true;
                        reticle.matrix.fromArray(hits[0].getPose(renderer.xr.getReferenceSpace()).transform.matrix);
                        if (!objectPlaced) document.getElementById('ar-guide').innerText = "TOQUE PARA POSICIONAR";
                    } else reticle.visible = false;
                }
            }
            if (contentGroup.visible || !renderer.xr.isPresenting) {
                fans.forEach(f => f.rotation.z -= 0.2);
                if (rgbTextureH) rgbTextureH.offset.x -= 0.015;
            }
            renderer.render(scene, camera);
        }
    </script>
</body>

</html>
