<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hardware AR Suite - Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00ffcc; --glass: rgba(10, 10, 12, 0.85); }

        body { 
            margin: 0; overflow: hidden; background: #050505; 
            font-family: 'Inter', sans-serif; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HUD SUPERIOR (Sele√ß√£o de Objetos) --- */
        #hud-top {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 20px 10px; box-sizing: border-box;
            background: linear-gradient(to bottom, black, transparent);
            display: flex; flex-direction: column; align-items: center;
            z-index: 10; pointer-events: none; /* Deixa clicar na cena 3D */
        }

        .title-badge {
            background: rgba(255,255,255,0.1); color: white;
            padding: 5px 15px; border-radius: 20px;
            font-size: 12px; font-weight: 800; letter-spacing: 1px;
            margin-bottom: 15px; backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        #selector-bar {
            display: flex; gap: 10px; pointer-events: auto;
            background: var(--glass); padding: 8px; border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .btn-obj {
            width: 60px; height: 60px; border-radius: 12px;
            border: none; background: rgba(255,255,255,0.05);
            color: #888; cursor: pointer; transition: 0.3s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        .btn-obj span { font-size: 24px; display: block; margin-bottom: 2px; }
        .btn-obj label { font-size: 9px; font-weight: 800; text-transform: uppercase; }

        .btn-obj.active {
            background: rgba(0, 255, 204, 0.15);
            color: var(--neon); box-shadow: 0 0 15px rgba(0, 255, 204, 0.2);
        }

        /* --- INFO T√âCNICA (Lateral) --- */
        #tech-info {
            position: absolute; bottom: 120px; left: 20px;
            color: white; pointer-events: none; opacity: 0.8;
        }
        .tech-label { font-size: 10px; color: #888; text-transform: uppercase; }
        .tech-val { font-size: 24px; font-weight: 800; color: var(--neon); }

        /* --- GUIDES & LOADER --- */
        #ar-hint {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: white; padding: 15px 25px;
            border-radius: 30px; border: 1px solid var(--neon);
            font-weight: bold; display: none; pointer-events: none;
        }

        #loader {
            position: absolute; inset: 0; background: #000; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            color: var(--neon); font-family: monospace;
        }

        /* Estiliza√ß√£o do Bot√£o AR Nativo */
        button#ARButton {
            background-color: white !important; color: black !important;
            border-radius: 50px !important; bottom: 30px !important;
            width: 180px !important; font-weight: 800 !important;
            box-shadow: 0 0 20px rgba(255,255,255,0.3) !important;
        }
    </style>
</head>
<body>

    <!-- HUD -->
    <div id="hud-top">
        <div class="title-badge">HARDWARE SUITE v2.0</div>
        <div id="selector-bar">
            <button class="btn-obj active" onclick="setMode('mobo')">
                <span>üéõÔ∏è</span><label>MOBO</label>
            </button>
            <button class="btn-obj" onclick="setMode('cpu')">
                <span>‚ùÑÔ∏è</span><label>COOLER</label>
            </button>
            <button class="btn-obj" onclick="setMode('gpu')">
                <span>üìº</span><label>GPU</label>
            </button>
            <button class="btn-obj" onclick="setMode('ram')">
                <span>üíæ</span><label>RAM</label>
            </button>
        </div>
    </div>

    <div id="tech-info">
        <div class="tech-label">MODELO ATIVO</div>
        <div class="tech-val" id="model-name">ASUS ROG MAXIMUS</div>
    </div>

    <div id="ar-hint">Mova o celular para detectar o ch√£o</div>
    <div id="loader">GERANDO GEOMETRIA 3D...</div>

    <!-- Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { ARButton } from 'three/addons/webxr/ARButton.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';

        // --- CONFIGURA√á√ÉO ---
        let camera, scene, renderer;
        let contentGroup, reticle;
        let hitTestSource = null, hitTestSourceRequested = false;
        let objectPlaced = false;
        
        // Anima√ß√µes
        let fans = [];
        let leds = [];

        // Materiais Cache
        const mats = {};

        init();
        animate();

        function init() {
            const container = document.createElement('div');
            document.body.appendChild(container);

            scene = new THREE.Scene();

            // C√¢mera
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);

            // Ilumina√ß√£o de Est√∫dio
            const ambient = new THREE.HemisphereLight(0xffffff, 0x222222, 1);
            scene.add(ambient);

            const mainLight = new THREE.DirectionalLight(0xffffff, 3);
            mainLight.position.set(1, 3, 1);
            mainLight.castShadow = true;
            mainLight.shadow.mapSize.width = 2048;
            mainLight.shadow.mapSize.height = 2048;
            mainLight.shadow.bias = -0.0001;
            scene.add(mainLight);

            // Luz de recorte (Rim Light) azulada
            const rimLight = new THREE.SpotLight(0x00ccff, 5);
            rimLight.position.set(-2, 2, -1);
            rimLight.lookAt(0,0,0);
            scene.add(rimLight);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            container.appendChild(renderer.domElement);

            // Bot√£o AR
            document.body.appendChild(ARButton.createButton(renderer, { 
                requiredFeatures: ['hit-test', 'dom-overlay'], 
                domOverlay: { root: document.body }
            }));

            // Inicializar Assets
            createMaterials();
            
            contentGroup = new THREE.Group();
            contentGroup.visible = false; // Come√ßa invis√≠vel no AR
            scene.add(contentGroup);

            // Carregar MOBO por padr√£o
            loadObject('mobo');

            // Ret√≠culo (Mira)
            reticle = new THREE.Mesh(
                new THREE.RingGeometry(0.1, 0.11, 32).rotateX(-Math.PI / 2),
                new THREE.MeshBasicMaterial({ color: 0x00ffcc })
            );
            reticle.matrixAutoUpdate = false;
            reticle.visible = false;
            scene.add(reticle);

            // Intera√ß√£o
            const controller = renderer.xr.getController(0);
            controller.addEventListener('select', onSelect);
            scene.add(controller);

            // Controles PC
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 0.05, 0);
            controls.update();

            // Eventos AR
            renderer.xr.addEventListener('sessionstart', () => {
                document.getElementById('ar-hint').style.display = 'block';
                contentGroup.visible = false;
                objectPlaced = false;
            });
            renderer.xr.addEventListener('sessionend', () => {
                document.getElementById('ar-hint').style.display = 'none';
                contentGroup.visible = true;
                contentGroup.position.set(0,0,0);
                camera.position.set(0, 0.4, 0.4);
                camera.lookAt(0,0,0);
            });

            window.addEventListener('resize', onWindowResize);
            document.getElementById('loader').style.display = 'none';
        }

        // --- MATERIAIS PREMIUM ---
        function createMaterials() {
            // Textura PCB Procedural
            const cvs = document.createElement('canvas'); cvs.width=1024; cvs.height=1024;
            const ctx = cvs.getContext('2d');
            ctx.fillStyle='#111'; ctx.fillRect(0,0,1024,1024);
            ctx.strokeStyle='#222'; ctx.lineWidth=4;
            for(let i=0; i<200; i++){
                ctx.beginPath(); ctx.moveTo(Math.random()*1024, Math.random()*1024);
                ctx.lineTo(Math.random()*1024, Math.random()*1024); ctx.stroke();
            }
            const pcbTex = new THREE.CanvasTexture(cvs);

            mats.pcb = new THREE.MeshStandardMaterial({ 
                map: pcbTex, color: 0x222222, roughness: 0.4, metalness: 0.1 
            });
            mats.blackMetal = new THREE.MeshStandardMaterial({ 
                color: 0x111111, roughness: 0.2, metalness: 0.9 
            });
            mats.aluminum = new THREE.MeshStandardMaterial({ 
                color: 0xcccccc, roughness: 0.3, metalness: 0.8 
            });
            mats.copper = new THREE.MeshStandardMaterial({ 
                color: 0xb87333, roughness: 0.4, metalness: 0.8 
            });
            mats.gold = new THREE.MeshStandardMaterial({ 
                color: 0xffd700, roughness: 0.2, metalness: 1.0 
            });
            mats.rgb = new THREE.MeshStandardMaterial({ 
                color: 0x000000, emissive: 0xff00aa, emissiveIntensity: 2 
            });
            mats.plastic = new THREE.MeshStandardMaterial({ 
                color: 0x111111, roughness: 0.6 
            });
        }

        // --- CONSTRUTORES 3D DETALHADOS ---

        // 1. PLACA M√ÉE (Super Detalhada)
        function buildMobo() {
            const g = new THREE.Group();
            
            // Base PCB (30.5cm x 24.4cm - Tamanho ATX Real)
            const pcb = new THREE.Mesh(new RoundedBoxGeometry(0.244, 0.005, 0.305, 4, 0.01), mats.pcb);
            pcb.receiveShadow = true; pcb.castShadow = true;
            g.add(pcb);

            // VRM Heatsinks (Massivos)
            const vrmTop = new THREE.Mesh(new THREE.BoxGeometry(0.14, 0.03, 0.04), mats.blackMetal);
            vrmTop.position.set(0, 0.015, -0.11); vrmTop.castShadow = true;
            g.add(vrmTop);

            const vrmLeft = new THREE.Mesh(new THREE.BoxGeometry(0.04, 0.03, 0.10), mats.blackMetal);
            vrmLeft.position.set(-0.08, 0.015, -0.06); vrmLeft.castShadow = true;
            g.add(vrmLeft);

            // I/O Shield com Logo RGB
            const ioShield = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.025, 0.14), mats.plastic);
            ioShield.position.set(-0.09, 0.012, -0.07); 
            g.add(ioShield);
            const logo = new THREE.Mesh(new THREE.BoxGeometry(0.051, 0.01, 0.08), mats.rgb);
            logo.position.set(-0.09, 0.025, -0.07); g.add(logo);
            leds.push(logo);

            // CPU Socket (Detalhado)
            const socketBase = new THREE.Mesh(new THREE.BoxGeometry(0.06, 0.006, 0.06), mats.plastic);
            socketBase.position.set(0, 0.005, -0.05); g.add(socketBase);
            const socketMetal = new THREE.Mesh(new THREE.BoxGeometry(0.04, 0.007, 0.04), mats.aluminum);
            socketMetal.position.set(0, 0.005, -0.05); g.add(socketMetal);

            // 4 Slots de RAM
            for(let i=0; i<4; i++) {
                const slot = new THREE.Mesh(new THREE.BoxGeometry(0.008, 0.01, 0.14), mats.plastic);
                slot.position.set(0.04 + (i*0.012), 0.005, -0.05);
                g.add(slot);
            }

            // 3 Slots PCIE x16 (Com refor√ßo met√°lico)
            for(let i=0; i<3; i++) {
                const slot = new THREE.Mesh(new THREE.BoxGeometry(0.18, 0.01, 0.012), mats.blackMetal);
                slot.position.set(0, 0.005, 0.04 + (i*0.06));
                // Detalhe met√°lico
                const shield = new THREE.Mesh(new THREE.BoxGeometry(0.18, 0.011, 0.004), mats.aluminum);
                shield.position.set(0, 0.005, 0.04 + (i*0.06) - 0.004);
                g.add(slot); g.add(shield);
            }

            // Chipset Heatsink
            const chipset = new THREE.Mesh(new THREE.BoxGeometry(0.08, 0.015, 0.08), mats.blackMetal);
            chipset.position.set(0.05, 0.007, 0.10); g.add(chipset);

            // Capacitores (Procedural)
            const capGeo = new THREE.CylinderGeometry(0.004, 0.004, 0.01, 8);
            for(let i=0; i<15; i++) {
                const cap = new THREE.Mesh(capGeo, mats.aluminum);
                cap.position.set(-0.05 + Math.random()*0.02, 0.005, -0.08 + Math.random()*0.08);
                g.add(cap);
            }

            return g;
        }

        // 2. CPU + COOLER (Torre Completa)
        function buildCooler() {
            const g = new THREE.Group();
            
            // CPU (Base)
            const pcb = new THREE.Mesh(new THREE.BoxGeometry(0.04, 0.002, 0.04), mats.pcb);
            g.add(pcb);
            const ihs = new THREE.Mesh(new THREE.BoxGeometry(0.034, 0.004, 0.034), mats.aluminum);
            ihs.position.y = 0.003; g.add(ihs);

            // Heatpipes (Cobre)
            const pipeGeo = new THREE.CylinderGeometry(0.003, 0.003, 0.14, 8);
            for(let i=0; i<4; i++) {
                const pipe = new THREE.Mesh(pipeGeo, mats.copper);
                pipe.position.y = 0.07; // Centro vertical
                pipe.position.x = (i*0.01) - 0.015;
                g.add(pipe);
            }

            // Heatsink (Bloco de Aletas) - Aumentei o tamanho
            const finGeo = new THREE.BoxGeometry(0.05, 0.001, 0.12);
            const fins = new THREE.Group();
            for(let i=0; i<30; i++) {
                const fin = new THREE.Mesh(finGeo, mats.aluminum);
                fin.position.y = 0.02 + (i*0.004);
                fins.add(fin);
            }
            g.add(fins);

            // Fan (Ventoinha Lateral)
            const fanCase = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.12, 0.025), mats.plastic);
            fanCase.position.set(0, 0.08, 0.075); // Frente do dissipador
            g.add(fanCase);

            // H√©lice
            const bladeGeo = new THREE.CylinderGeometry(0.05, 0.05, 0.005, 32);
            const blade = new THREE.Mesh(bladeGeo, mats.rgb); // RGB Fans!
            blade.rotation.x = Math.PI/2;
            blade.position.set(0, 0.08, 0.088);
            g.add(blade);
            fans.push(blade);
            leds.push(blade); // Blade brilha

            // Placa Topo (Est√©tica)
            const topPlate = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.002, 0.12), mats.blackMetal);
            topPlate.position.y = 0.14; g.add(topPlate);

            // Elevar para ficar no ch√£o
            g.position.y = 0.01;

            return g;
        }

        // 3. GPU (Triple Fan Monster)
        function buildGPU() {
            const g = new THREE.Group();
            
            // Corpo Principal (32cm)
            const body = new THREE.Mesh(new RoundedBoxGeometry(0.32, 0.06, 0.13, 4, 0.01), mats.blackMetal);
            body.position.y = 0.06; body.castShadow = true;
            g.add(body);

            // 3 Fans
            for(let i=-1; i<=1; i++) {
                const fanGroup = new THREE.Group();
                fanGroup.position.set(i*0.095, 0.06, 0.066); // Face frontal
                
                // H√©lice
                const blade = new THREE.Mesh(new THREE.CylinderGeometry(0.04, 0.04, 0.005, 7), mats.plastic);
                blade.rotation.x = Math.PI/2;
                fanGroup.add(blade);
                fans.push(fanGroup);
                
                // Aro RGB
                const ring = new THREE.Mesh(new THREE.TorusGeometry(0.042, 0.001, 16, 32), mats.rgb);
                ring.rotation.x = Math.PI/2;
                fanGroup.add(ring);
                leds.push(ring);

                g.add(fanGroup);
            }

            // Backplate
            const plate = new THREE.Mesh(new THREE.BoxGeometry(0.32, 0.13, 0.002), mats.aluminum);
            plate.rotation.x = Math.PI/2;
            plate.position.y = 0.091;
            g.add(plate);

            // Posi√ß√£o de descanso
            g.rotation.x = -Math.PI/2; // Deitada
            g.position.y = 0.02;

            return g;
        }

        // 4. RAM (Par de Mem√≥rias)
        function buildRAM() {
            const g = new THREE.Group();
            
            // Criar 2 pentes
            for(let i=0; i<2; i++) {
                const stick = new THREE.Group();
                // Dissipador
                const heat = new THREE.Mesh(new THREE.BoxGeometry(0.133, 0.04, 0.008), mats.blackMetal);
                stick.add(heat);
                // RGB Topo
                const rgb = new THREE.Mesh(new THREE.BoxGeometry(0.133, 0.005, 0.008), mats.rgb);
                rgb.position.y = 0.02; 
                stick.add(rgb); leds.push(rgb);
                // Contatos
                const gold = new THREE.Mesh(new THREE.BoxGeometry(0.13, 0.005, 0.002), mats.gold);
                gold.position.y = -0.022; stick.add(gold);

                stick.position.z = i * 0.02; // Separados por 2cm
                g.add(stick);
            }

            // Flutuando para apresenta√ß√£o
            g.position.y = 0.05;
            g.rotation.x = Math.PI / 6; // Levemente inclinado

            return g;
        }

        // --- CONTROLE UI ---
        window.setMode = function(type) {
            // Update Buttons
            document.querySelectorAll('.btn-obj').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Update Text
            const titles = {
                'mobo': 'ASUS ROG MAXIMUS',
                'cpu': 'COOLER MASTER HYPER 212',
                'gpu': 'RTX 4090 SUPRIM X',
                'ram': 'G.SKILL TRIDENT Z RGB'
            };
            document.getElementById('model-name').innerText = titles[type];

            loadObject(type);
        }

        function loadObject(type) {
            contentGroup.clear();
            fans = []; leds = [];

            let mesh;
            if(type === 'mobo') mesh = buildMobo();
            if(type === 'cpu') mesh = buildCooler();
            if(type === 'gpu') mesh = buildGPU();
            if(type === 'ram') mesh = buildRAM();

            contentGroup.add(mesh);
        }

        // --- HIT TEST & AR LOOP ---
        function onSelect() {
            if (reticle.visible) {
                contentGroup.position.setFromMatrixPosition(reticle.matrix);
                // Virar para o usu√°rio
                const p = new THREE.Vector3();
                camera.getWorldPosition(p);
                contentGroup.lookAt(p.x, contentGroup.position.y, p.z);
                
                contentGroup.visible = true;
                objectPlaced = true;
                document.getElementById('ar-hint').innerText = "Objeto fixado!";
                setTimeout(() => document.getElementById('ar-hint').style.display = 'none', 2000);
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            renderer.setAnimationLoop(render);
        }

        function render(timestamp, frame) {
            const time = timestamp;

            // AR Hit Test logic
            if (frame) {
                const session = renderer.xr.getSession();
                const refSpace = renderer.xr.getReferenceSpace();

                if (!hitTestSourceRequested) {
                    session.requestReferenceSpace('viewer').then(space => {
                        session.requestHitTestSource({ space }).then(source => hitTestSource = source);
                    });
                    hitTestSourceRequested = true;
                }

                if (hitTestSource) {
                    const hits = frame.getHitTestResults(hitTestSource);
                    if (hits.length > 0) {
                        const hit = hits[0];
                        reticle.visible = true;
                        reticle.matrix.fromArray(hit.getPose(refSpace).transform.matrix);
                        if(!objectPlaced) document.getElementById('ar-hint').innerText = "Toque para posicionar";
                    } else {
                        reticle.visible = false;
                    }
                }
            }

            // Anima√ß√µes de Hardware
            if(contentGroup.visible || !renderer.xr.isPresenting) {
                // Ventoinhas girando
                fans.forEach(f => f.rotation.z -= 0.2);
                
                // LEDs RGB Rainbow
                const hue = (time * 0.0005) % 1;
                leds.forEach(l => l.material.emissive.setHSL(hue, 1, 0.5));

                // Rota√ß√£o "Showcase" suave no PC (no AR fica parado onde colocou)
                if(!renderer.xr.isPresenting) {
                    contentGroup.rotation.y += 0.003;
                }
            }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>


