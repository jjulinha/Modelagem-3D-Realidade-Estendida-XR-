<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hardware AR - Ultimate (Melhorado)</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root{ --primary:#00ff88; --glass:rgba(10,15,20,0.80); --border:rgba(255,255,255,0.08); }
        body{ margin:0; overflow:hidden; background:#050505; font-family:'Rajdhani',sans-serif; user-select:none; }
        #info-panel{ position:absolute; top:0; left:0; width:100%; padding:18px; box-sizing:border-box; background:linear-gradient(to bottom, rgba(0,0,0,0.92), transparent); z-index:10; pointer-events:none }
        h1{ margin:0; color:#fff; font-size:22px; display:flex; gap:10px; align-items:center; text-transform:uppercase }
        .badge{ background:var(--primary); color:#000; padding:2px 6px; border-radius:5px; font-weight:800; font-size:11px }
        #subtitle{ color:#888; font-size:13px; margin-top:6px; font-weight:600 }
        #selection-dock{ position:absolute; bottom:96px; left:50%; transform:translateX(-50%); display:flex; gap:14px; padding:10px 18px; background:var(--glass); backdrop-filter:blur(12px); border-radius:22px; border:1px solid var(--border); z-index:20 }
        .model-btn{ width:58px; height:58px; border-radius:14px; background:rgba(255,255,255,0.04); display:flex; flex-direction:column; align-items:center; justify-content:center; color:#fff; cursor:pointer }
        .model-btn.active{ background:rgba(0,255,136,0.12); transform:translateY(-6px); box-shadow:0 6px 18px rgba(0,255,136,0.12) }
        #ar-guide{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.8); border:1px solid var(--primary); color:#fff; padding:12px 20px; border-radius:40px; font-weight:700; display:none; pointer-events:none }
        #loader{ position:absolute; inset:0; background:#000; z-index:100; display:flex; flex-direction:column; justify-content:center; align-items:center; color:var(--primary); }
        .spinner{ width:36px; height:36px; border:3px solid #111; border-top:3px solid var(--primary); border-radius:50%; animation:spin 1s linear infinite }
        @keyframes spin{ to{ transform:rotate(360deg) } }
        button#ARButton{ background:#fff !important; color:#000 !important; border-radius:30px !important; bottom:30px !important; width:160px !important; font-weight:800 !important }
    </style>
</head>
<body>
    <div id="info-panel">
        <h1><span id="model-title">ASUS ROG MAXIMUS</span><span class="badge">AR V3.0</span></h1>
        <div id="subtitle">SISTEMA DE ALTA FIDELIDADE ‚Ä¢ ESCALA 1:1</div>
    </div>

    <div id="selection-dock">
        <div class="model-btn active" onclick="window.selectModel('mobo', this)"><div>üéõÔ∏è</div><div style="font-size:10px;margin-top:4px">MOBO</div></div>
        <div class="model-btn" onclick="window.selectModel('cpu', this)"><div>‚ùÑÔ∏è</div><div style="font-size:10px;margin-top:4px">COOLER</div></div>
        <div class="model-btn" onclick="window.selectModel('gpu', this)"><div>üìº</div><div style="font-size:10px;margin-top:4px">GPU</div></div>
        <div class="model-btn" onclick="window.selectModel('ram', this)"><div>üíæ</div><div style="font-size:10px;margin-top:4px">RAM</div></div>
    </div>

    <div id="ar-guide">MOVA O CELULAR PARA ESCANEAR...</div>
    <div id="loader"><div class="spinner"></div><div style="margin-top:12px">CARREGANDO ASSETS...</div></div>

    <script type="importmap">{ "imports": { "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js", "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/" } }</script>

    <script type="module">
    import * as THREE from 'three';
    import { ARButton } from 'three/addons/webxr/ARButton.js';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';

    // ---------- Setup ----------
    let camera, scene, renderer, contentGroup, reticle;
    let hitTestSource = null, hitTestSourceRequested = false, objectPlaced = false;
    let fans = [], floatParts = [], mats = {}, rgbTextureH, rgbTextureV, microBump;

    init(); animate();

    function init(){
        const container = document.createElement('div'); document.body.appendChild(container);
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.01, 50);

        // Est√∫dio: luz ambiente e key lights
        const hemi = new THREE.HemisphereLight(0xffffff, 0x222222, 0.6); scene.add(hemi);
        const key = new THREE.DirectionalLight(0xffffff, 3.0); key.position.set(2,4,2); scene.add(key);
        const fill = new THREE.DirectionalLight(0xbfdfff, 0.8); fill.position.set(-2,1,-1); scene.add(fill);
        const rim = new THREE.SpotLight(0x00ff88, 4.0); rim.position.set(-3,2,-2); scene.add(rim);

        renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true }); renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)); renderer.setSize(window.innerWidth, window.innerHeight); renderer.xr.enabled = true; renderer.shadowMap.enabled = true; renderer.toneMapping = THREE.ACESFilmicToneMapping; container.appendChild(renderer.domElement);

        document.body.appendChild(ARButton.createButton(renderer, { requiredFeatures:['hit-test','dom-overlay'], domOverlay:{ root: document.body } }));

        createMaterials();

        contentGroup = new THREE.Group(); scene.add(contentGroup);
        loadObject('mobo');

        // Reticle
        reticle = new THREE.Mesh(new THREE.RingGeometry(0.12,0.14,64).rotateX(-Math.PI/2), new THREE.MeshStandardMaterial({ color:0x00ff88 }));
        reticle.matrixAutoUpdate = false; reticle.visible = false; scene.add(reticle);

        const controller = renderer.xr.getController(0); controller.addEventListener('select', onSelect); scene.add(controller);

        const controls = new OrbitControls(camera, renderer.domElement); controls.target.set(0,0.06,0); controls.update();

        renderer.xr.addEventListener('sessionstart', ()=>{ document.getElementById('ar-guide').style.display='block'; document.getElementById('info-panel').style.opacity='0'; contentGroup.visible=false; });
        renderer.xr.addEventListener('sessionend', ()=>{ document.getElementById('ar-guide').style.display='none'; document.getElementById('info-panel').style.opacity='1'; contentGroup.visible=true; contentGroup.position.set(0,0,0); camera.position.set(0,0.3,0.3); camera.lookAt(0,0,0); objectPlaced=false; });

        window.addEventListener('resize', onWindowResize);
        document.getElementById('loader').style.display='none';
    }

    function createMaterials(){
        // PCB procedural (maior densidade de trilhas)
        const cvs = document.createElement('canvas'); cvs.width=1024; cvs.height=1024; const ctx=cvs.getContext('2d'); ctx.fillStyle='#061214'; ctx.fillRect(0,0,1024,1024);
        ctx.strokeStyle='#0b3a2d'; ctx.lineWidth=1.2; for(let i=0;i<250;i++){ ctx.beginPath(); ctx.moveTo(Math.random()*1024, Math.random()*1024); ctx.lineTo(Math.random()*1024, Math.random()*1024); ctx.stroke(); }
        const pcbTex = new THREE.CanvasTexture(cvs); pcbTex.wrapS = pcbTex.wrapT = THREE.RepeatWrapping; pcbTex.repeat.set(1,1);

        // RGB gradients
        const cvsH=document.createElement('canvas'); cvsH.width=1024; cvsH.height=2; const cH=cvsH.getContext('2d'); const gH=cH.createLinearGradient(0,0,1024,0); gH.addColorStop(0,'#ff0040'); gH.addColorStop(0.2,'#ffea00'); gH.addColorStop(0.4,'#00ff66'); gH.addColorStop(0.6,'#00e7ff'); gH.addColorStop(0.8,'#1b4dff'); gH.addColorStop(1,'#ff2dd9'); cH.fillStyle=gH; cH.fillRect(0,0,1024,2); rgbTextureH=new THREE.CanvasTexture(cvsH); rgbTextureH.wrapS=THREE.RepeatWrapping; rgbTextureH.repeat.set(1,1);
        const cvsV=document.createElement('canvas'); cvsV.width=2; cvsV.height=1024; const cV=cvsV.getContext('2d'); const gV=cV.createLinearGradient(0,0,0,1024); gV.addColorStop(0,'#ff0040'); gV.addColorStop(0.2,'#ffea00'); gV.addColorStop(0.4,'#00ff66'); gV.addColorStop(0.6,'#00e7ff'); gV.addColorStop(0.8,'#1b4dff'); gV.addColorStop(1,'#ff2dd9'); cV.fillStyle=gV; cV.fillRect(0,0,2,1024); rgbTextureV=new THREE.CanvasTexture(cvsV); rgbTextureV.wrapT=THREE.RepeatWrapping; rgbTextureV.repeat.set(1,1);

        // Micro-bump (grayscale noise) para dar relevo sutil
        const bumpC=document.createElement('canvas'); bumpC.width=256; bumpC.height=256; const bctx=bumpC.getContext('2d'); for(let x=0;x<256;x++){ for(let y=0;y<256;y++){ const v = Math.floor(128 + (Math.random()*32 -16)); bctx.fillStyle = `rgb(${v},${v},${v})`; bctx.fillRect(x,y,1,1); }} microBump = new THREE.CanvasTexture(bumpC); microBump.wrapS=microBump.wrapT=THREE.RepeatWrapping; microBump.repeat.set(4,4);

        mats.pcb = new THREE.MeshStandardMaterial({ map:pcbTex, roughness:0.55, metalness:0.06, bumpMap:microBump, bumpScale:0.002 });
        mats.metal = new THREE.MeshStandardMaterial({ color:0x1b1b1b, roughness:0.26, metalness:0.95, envMapIntensity:1.0 });
        mats.alum = new THREE.MeshStandardMaterial({ color:0xcfcfcf, roughness:0.38, metalness:0.85, bumpMap:microBump, bumpScale:0.0015 });
        mats.gold = new THREE.MeshStandardMaterial({ color:0xffcc33, roughness:0.18, metalness:1.0 });
        mats.copper = new THREE.MeshStandardMaterial({ color:0xc06b30, roughness:0.35, metalness:0.8 });
        mats.rgbH = new THREE.MeshBasicMaterial({ map:rgbTextureH }); mats.rgbV = new THREE.MeshBasicMaterial({ map:rgbTextureV });
    }

    // --- Model selection ---
    window.selectModel = function(type, btn){ document.querySelectorAll('.model-btn').forEach(b=>b.classList.remove('active')); if(btn) btn.classList.add('active'); const titles={ 'mobo':['ASUS ROG MAXIMUS','E-ATX ‚Ä¢ Z790 CHIPSET'], 'cpu':['RYZEN 9 + COOLER','IHS REALISTO ‚Ä¢ 37mm'], 'gpu':['RTX 4090 SUPRIM','304mm ‚Ä¢ 2.5 SLOT'], 'ram':['TRIDENT Z5 RGB','DDR5 6400MHZ ‚Ä¢ 133mm'] }; document.getElementById('model-title').innerText=titles[type][0]; document.getElementById('subtitle').innerText=titles[type][1]; loadObject(type); }

    function loadObject(type){ contentGroup.clear(); fans=[]; floatParts=[]; if(type==='mobo') buildMobo(); if(type==='cpu') buildCPU_Cooler(); if(type==='gpu') buildGPU(); if(type==='ram') buildRAM(); }

    // ---------- Builders ----------
    function buildMobo(){
        const g = new THREE.Group();
        // MOBO realistic E-ATX 305 x 272 mm (em metros)
        const w = 0.305, h = 0.0025, d = 0.272;
        const pcb = new THREE.Mesh(new RoundedBoxGeometry(w, h, d, 6, 0.006, 16), mats.pcb);
        pcb.receiveShadow=true; g.add(pcb);

        // Heatsinks - VRM com extrus√£o de aletas
        for(let i=0;i<3;i++){
            const base = new THREE.Mesh(new THREE.BoxGeometry(0.04,0.02,0.08,4,1,4), mats.metal); base.position.set(-0.08 + i*0.06, 0.011, -0.05 + i*0.01); g.add(base);
            // Aletas finas
            const fins = new THREE.Group();
            const finCount=24;
            for(let f=0; f<finCount; f++){ const fin = new THREE.Mesh(new THREE.BoxGeometry(0.04,0.001,0.08/finCount,1,1,1), mats.alum); fin.position.set(0,0.011 + (f*0.0009), -0.04 + f*(0.08/finCount)); fins.add(fin); }
            fins.position.set(-0.08 + i*0.06, 0, -0.05 + i*0.01); g.add(fins);
        }

        // I/O shield estilizado (RGB vertical)
        const io = new THREE.Mesh(new THREE.BoxGeometry(0.06,0.035,0.002,1,1,1), mats.metal); io.position.set(-w/2 + 0.035, 0.013, -d/2 + 0.02); g.add(io);
        const ioRGB = new THREE.Mesh(new THREE.PlaneGeometry(0.032,0.12,1,1), mats.rgbV); ioRGB.rotation.x = -Math.PI/2; ioRGB.position.set(-w/2 + 0.035, 0.032, -d/2 + 0.02); g.add(ioRGB);

        // PCIe slots (mais realistas e proporcionais)
        for(let i=0;i<3;i++){ const slot = new THREE.Mesh(new THREE.BoxGeometry(0.17,0.009,0.012,4,1,2), mats.alum); slot.position.set(0.02, 0.006, -0.05 + i*0.08); g.add(slot); }

        // CPU socket box (visual)
        const socket = new THREE.Mesh(new THREE.BoxGeometry(0.04,0.0022,0.04,4,1,4), mats.metal); socket.position.set(0,0.0015,0); g.add(socket);

        // Sinais e dissipadores menores
        const caps = new THREE.Group(); for(let i=0;i<30;i++){ const c=new THREE.Mesh(new THREE.BoxGeometry(0.004,0.006,0.004), mats.gold); c.position.set((Math.random()-0.5)*0.12, 0.004, (Math.random()-0.5)*0.12); caps.add(c); } caps.position.set(0.06,0,0.04); g.add(caps);

        g.scale.set(1,1,1); g.position.y = 0.012; contentGroup.add(g);
    }

    function buildCPU_Cooler(){
        const g = new THREE.Group();
        // CPU real ~ 37mm IHS
        const cpu = new THREE.Group(); const cpuSize=0.037; const ihs = new THREE.Mesh(new THREE.BoxGeometry(cpuSize,0.004, cpuSize,4,1,4), mats.alum); ihs.position.y=0.003; cpu.add(ihs);
        cpu.position.set(0,0.0035,0); g.add(cpu);

        // Cooler torre realista (torre de aletas com fan)
        const tower = new THREE.Group();
        const base = new THREE.Mesh(new THREE.BoxGeometry(0.06,0.008,0.06,8,1,8), mats.copper); base.position.y=0.01; tower.add(base);
        // Aletas empilhadas
        const finCount = 36; for(let i=0;i<finCount;i++){ const fin = new THREE.Mesh(new THREE.BoxGeometry(0.06,0.0018,0.045,4,1,4), mats.alum); fin.position.y = 0.02 + i*0.0018; fin.rotation.y = (i%2?0.01:-0.01); tower.add(fin); }

        // Fan front
        const fan = new THREE.Group(); const hub = new THREE.Mesh(new THREE.CylinderGeometry(0.01,0.01,0.02,32), mats.metal); hub.rotation.x = Math.PI/2; fan.add(hub);
        const bladeCount = 9; for(let i=0;i<bladeCount;i++){ const blade = new THREE.Mesh(new THREE.BoxGeometry(0.03,0.003,0.01,4,1,1), mats.metal); blade.position.x=0.045; const p=new THREE.Group(); p.rotation.z=(i/bladeCount)*Math.PI*2; p.add(blade); fan.add(p); }
        fan.position.set(0, 0.055, 0.02); fans.push(fan); tower.add(fan);

        tower.position.set(0,0,0); tower.userData={baseY:0.03,floatH:0.02}; floatParts.push(tower);
        g.add(tower); contentGroup.add(g);
    }

    function buildGPU(){
        const g = new THREE.Group();
        // GPU length 304 mm (~0.304 m), height ~0.04
        const length = 0.304, height=0.044, depth=0.14;
        const body = new THREE.Mesh(new RoundedBoxGeometry(length, height, depth, 6, 0.01, 24), mats.metal);
        body.position.y = height/2; body.castShadow=true; g.add(body);

        // Lateral strip RGB
        const strip = new THREE.Mesh(new THREE.BoxGeometry(length*0.82, 0.006, 0.004, 8,1,1), mats.rgbH);
        strip.position.set(0, height*0.45, depth/2 - 0.006); g.add(strip);

        // Triple fan set (mais realista)
        const fanPositions = [-length*0.18, 0, length*0.18];
        fanPositions.forEach((xpos)=>{
            const ring = new THREE.Mesh(new THREE.TorusGeometry(0.055,0.003,16,64), mats.rgbH); ring.rotation.x = -Math.PI/2; ring.position.set(xpos, height*0.7, 0); g.add(ring);
            const fGroup = new THREE.Group(); const bladeCount=11; for(let k=0;k<bladeCount;k++){ const blade = new THREE.Mesh(new THREE.BoxGeometry(0.06,0.005,0.002,4,1,1), mats.metal); blade.position.x = 0.03; blade.rotation.x=0.25; const p = new THREE.Group(); p.rotation.z=(k/bladeCount)*Math.PI*2; p.add(blade); fGroup.add(p); } fGroup.position.set(xpos, height*0.66, 0); fans.push(fGroup); g.add(fGroup);
        });

        g.rotation.x = -Math.PI/2; g.position.y = 0.02; contentGroup.add(g);
    }

    function buildRAM(){
        const g = new THREE.Group();
        const length = 0.133, height = 0.042, thickness = 0.008;
        for(let i=0;i<2;i++){
            const stick = new THREE.Group();
            const pcb = new THREE.Mesh(new THREE.BoxGeometry(length, thickness, 0.012, 8,1,4), mats.pcb); pcb.position.y = 0.006; stick.add(pcb);
            const heats = new THREE.Mesh(new THREE.BoxGeometry(length, 0.03, 0.012, 8,4,2), mats.metal); heats.position.y = 0.02; stick.add(heats);
            const rgb = new THREE.Mesh(new THREE.BoxGeometry(length*0.9, 0.006, 0.01, 8,1,1), mats.rgbH); rgb.position.y = 0.035; stick.add(rgb);
            stick.position.set(0, 0.02, (i-0.5)*0.025); g.add(stick);
        }
        g.position.y = 0.05; contentGroup.add(g);
    }

    // ---------- Interaction & Render ----------
    function onSelect(){ if(reticle.visible){ const p=new THREE.Vector3(); camera.getWorldPosition(p); contentGroup.position.setFromMatrixPosition(reticle.matrix); if(Math.abs(p.x-contentGroup.position.x)>0.01) contentGroup.lookAt(p.x, contentGroup.position.y, p.z); contentGroup.visible=true; objectPlaced=true; document.getElementById('ar-guide').innerText='OBJETO FIXADO'; setTimeout(()=>document.getElementById('ar-guide').style.display='none',1700); }}

    function onWindowResize(){ camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }

    function animate(){ renderer.setAnimationLoop(render); }

    function render(timestamp, frame){ const t = timestamp/1000;
        if(frame){ const session = renderer.xr.getSession(); if(!hitTestSourceRequested){ session.requestReferenceSpace('viewer').then(ref=> session.requestHitTestSource({ space: ref }).then(source=> hitTestSource = source)); hitTestSourceRequested = true; }
            if(hitTestSource){ const hits = frame.getHitTestResults(hitTestSource); if(hits.length>0){ reticle.visible=true; reticle.matrix.fromArray(hits[0].getPose(renderer.xr.getReferenceSpace()).transform.matrix); if(!objectPlaced) document.getElementById('ar-guide').innerText='TOQUE PARA POSICIONAR'; } else reticle.visible=false; } }

        if(contentGroup.visible || !renderer.xr.isPresenting){ fans.forEach(f=> f.rotation.z -= 0.18 ); floatParts.forEach(p=> p.position.y = p.userData.baseY + (Math.sin(t*2)*0.5+0.5)*p.userData.floatH ); if(rgbTextureH) rgbTextureH.offset.x -= 0.012; if(rgbTextureV) rgbTextureV.offset.y -= 0.012; if(!renderer.xr.isPresenting) contentGroup.rotation.y += 0.0025; }
        renderer.render(scene, camera);
    }
    </script>
</body>
</html>
